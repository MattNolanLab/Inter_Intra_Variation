---
title: "ModifiedGapStatistic"
author: "Matt Nolan"
date: "28/02/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

source("ModifiedGap_Functions.R")
```

## Modified gap statistic

Goal is to reimplement matlab code written by Hugh.

Start with an example dataset. We use mouse_20140522. This is the mouse used in Figure 2.
```{r}
test_data <- filter(data.sc, id == "mouse_20140522") %>%
  select(dvlocmm, rheo)
K.max <- 9

ggplot(test_data, aes(dvlocmm, rheo)) +
  geom_point()

rheo_gap <- clusGap_Extra(test_data$rheo, K_max = K.max)

ggplot(rheo_gap) +
  geom_point(aes(clus_num, logW), colour = "blue") +
  geom_point(aes(clus_num, E.logW), colour = "red")

ggplot(rheo_gap, aes(clus_num, gap)) +
  geom_point() +
  geom_errorbar(aes(ymin = gap_min, ymax = gap_max))
```


Generate gap statistics for simulated uniform distributions.
```{r}
# Parameters
n_sim <- 20 # Use ≤ 20 for testing code. Use ≥ 500 for analyses.
n_cells <- length(test_data$rheo)

# Generate simulated gap data
sim_tib <- gap_uniform_sim(n_cells, K.max, n_sim)
# Return cut off values from the data
cut_off_vals <- calc_cutoffs(sim_tib$gap_delta)
```


Calculate delta gap for real and simulated data and then compare.
```{r}
rheo_diff = tibble(clus_num = c(1:(K.max-1)), gap_diff = diff(rheo_gap$gap))

rheo_diff$gap_thresh <- cut_off_vals

ggplot(rheo_diff) +
  geom_point(aes(clus_num, gap_diff), colour = "red") +
  geom_point(aes(clus_num, gap_thresh), colour = "blue")

```





---
title: "ConceptualFigures"
author: "Matt Nolan"
date: "07/05/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Ensure access to libraries
library(tidyverse)
library(gridExtra)
```

## Goals

To generate schematic diagrams to illustrate the ideas to be tested by the analyses.

First generate simulated data. Imagine a dataset describing individual cells using two quantifiable features (x and y). In this scenario different cell class could be separated using these features. Each cell class is modeled as having variance for each feature.

The distribution of features of cell class A has a simple structure in which the variance is around a point.

For cell class B the distribution of features is along a line.

Cell classes C and D have a similar distribution to A, but are centered at different values of one or both features.
```{r}
numcells <- 100
Cell_A <- tibble(x = rnorm(numcells, 10, 1),
                       y = rnorm(numcells, 12, 1),
                       cell = "A")
Cell_B <- tibble(x = runif(numcells, min = 20, max = 40) + rnorm(numcells,0,1),
                       y = rnorm(numcells, 25, 2),
                       cell = "B")
Cell_C <- tibble(x = rnorm(numcells, 10, 2),
                       y = rnorm(numcells, 35, 2),
                       cell = "C")
Cell_D <- tibble(x = rnorm(numcells, 30, 2),
                       y = rnorm(numcells, 10, 2),
                       cell = "D")
 
CellFeatures <- bind_rows(Cell_A, Cell_B, Cell_C, Cell_D)
```

Plot features. Try to use colour blind friendly colours.
  geom_point(aes(A_x, A_y), colour = "#2b8cbe") +
  geom_point(aes(B_x, B_y), colour = "#de2d26") +
  geom_point(aes(C_x, C_y), colour = "#2ca25f") +
  geom_point(aes(D_x, D_y), colour = "#49006a") +
```{r}
CF_plot <- ggplot(CellFeatures, aes(x, y, colour = cell)) +
  geom_point() +
  xlim(0,45) +
  ylim(0,45) +
  labs(x = "Feature 1", y = "Feature 2", colour = "Cell Type", title = "Cell type organisation") +
  theme_classic() +
  theme(legend.position = "bottom")

CF_plot
```

Focus on cell class B. First imagine how a distribution like the one above could be generated by pooling data from multiple animals in which the actual distribution is modular. Consider colour / intensity coding the points to reflect a functional variable, e.g. dorsoventral position in MEC.
```{r}
numcells <- 20
ModularFeatures <- tibble(A_x = c(rnorm(numcells, 25, 1), rnorm(numcells, 30, 1), rnorm(numcells, 35, 1)), A_y = rnorm(numcells*3, 25, 1), B_x = c(rnorm(numcells, 27.5, 1), rnorm(numcells, 32.5, 1), rnorm(numcells, 37.5, 1)), B_y = rnorm(numcells*3, 25, 1))

MF_plot <- ggplot(ModularFeatures) +
  geom_point(aes(A_x, A_y), colour = "#de2d26") +
  geom_point(aes(B_x, B_y), colour = "#fc9272") +
  xlim(20,45) +
  ylim(20,30) +
  xlab("Feature 1") +
  ylab("Feature 2") +
  annotate("text", label = "Animal 1", x = 40, y = 30, size = 5, colour = "#de2d26") +
  annotate("text", label = "Animal 2", x = 40, y = 28, size = 5, colour = "#fc9272") +
  theme_classic() +
  theme(axis.title.x=element_blank())

MF_plot
```


Next imagine a scenarion in which the distribution in D is continuous within an animal, but for which there are inter-animal differences in the mean of feature 2.
```{r}
numcells <- 60
OrthogOffsetFeatures <- tibble(A_x = runif(numcells, min = 25, max = 40) + rnorm(numcells,0,1), A_y = rnorm(numcells, 24, 1), B_x = runif(numcells, min = 25, max = 40) + rnorm(numcells,0,1), B_y = rnorm(numcells, 26, 1))

OOF_plot <- ggplot(OrthogOffsetFeatures) +
  geom_point(aes(A_x, A_y), colour = "#de2d26") +
  geom_point(aes(B_x, B_y), colour = "#fc9272") +
  xlim(20,45) +
  ylim(20,30) +
  xlab("Feature 1") +
  ylab("Feature 2") +
  theme_classic()

OOF_plot
```



Finally, imagine a scenario in which the distribution in D is continuous within an animal but the range across the variable feature differs between animals.

```{r}
numcells <- 60
LinearOffsetFeatures <- tibble(A_x = runif(numcells, min = 25, max = 35) + rnorm(numcells,0,1), A_y = rnorm(numcells, 25, 1), B_x = runif(numcells, min = 30, max = 40) + rnorm(numcells,0,1), B_y = rnorm(numcells, 25, 1))

LOF_plot <- ggplot(LinearOffsetFeatures) +
  geom_point(aes(A_x, A_y), colour = "#de2d26") +
  geom_point(aes(B_x, B_y), colour = "#fc9272") +
  xlim(20,45) +
  ylim(20,30) +
  xlab("Feature 1") +
  ylab("Feature 2") +
  theme_classic()

LOF_plot
```

Combine models for intra-animal variation and make plots using facets.
```{r}
ModularFeatures$scheme <- "modular"
OrthogOffsetFeatures$scheme <- "orthog"
LinearOffsetFeatures$scheme <- "linear"
IntraAnimal <- bind_rows(ModularFeatures, OrthogOffsetFeatures, LinearOffsetFeatures)
IntraAnimal$scheme <- as.factor(IntraAnimal$scheme)
IntraAnimal$scheme = factor(IntraAnimal$scheme, c("modular", "orthog","linear"))
labels_schemes <- c(modular = "Modular", orthog = "Orthogonal", linear = "Linear")

IntraAnimalPlot <- ggplot(IntraAnimal) +
  geom_point(aes(A_x, A_y), colour = "#de2d26") +
  geom_point(aes(B_x, B_y), colour = "#fc9272") +
  xlim(20,45) +
  ylim(20,30) +
  xlab("Feature 1") +
  ylab("Feature 2") +
  facet_wrap(~scheme, nrow = 3, labeller = labeller(scheme = labels_schemes)) +
  theme_classic() +
  theme(strip.background = element_blank())

IntraAnimalPlot
  
```



Plot all together.
```{r}
grid.arrange(CF_plot, IntraAnimalPlot,
             ncol = 2,
             widths = c(1.5,1))
```

